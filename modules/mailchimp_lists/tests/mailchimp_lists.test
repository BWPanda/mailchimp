<?php
/**
 * @file
 * Test class and methods for the Mailchimp Lists module.
 */

class MailchimpListsTestCase extends DrupalWebTestCase {

  /**
   * Returns info displayed in the test interface.
   *
   * @return array
   *   Formatted as specified by simpletest.
   */
  public static function getInfo() {
    // Note: getInfo() strings are not translated with t().
    return array(
      'name' => 'Mailchimp Lists',
      'description' => 'Test List Subscription Logic.',
      'group' => 'MailChimp',
    );
  }

  /**
   * Pre-test setup function.
   *
   * Enables dependencies.
   * Creates sign-up forms.
   * Sets the mailchimp_api_key to the test-mode key.
   * Sets up the 3 mailchimp_lists entities used in our tests:
   *
   * anonymous_test_list entity attaches to the Mailchimp List test_list_A
   *
   * optional_test_list entity attaches to the Mailchimp List test_list_B
   *
   * required_test_list entity attaches to the Mailchimp List test_list_C
   */
  public function setUp() {
    // Use a profile that contains required modules:
    $prof = drupal_get_profile();
    $this->profile = $prof;
    // Enable modules required for the test.
    $enabled_modules = array(
      'libraries',
      'mailchimp',
      'entity',
      'entity_token',
      'mailchimp_lists',
    );
    parent::setUp($enabled_modules);
    variable_set('mailchimp_api_classname', 'MailChimpTest');

    // Create some users with different roles/permissions.
    $this->authorized_user = $this->drupalCreateUser(array());
    // Create some lists.
    $lists = $this->getTestLists();

    cache_set('mailchimp_lists', $lists, 'cache_mailchimp', CACHE_PERMANENT);
  }

  /**
   * Tests list subscription.
   */
  public function testSubscription() {

  }

  /**
   * Helper function to generate a random email address.
   *
   * @return string
   *   approximate email format
   */
  protected function randomEmail() {
    return $this->randomName() . "@" . $this->randomName() . ".net";
  }
}